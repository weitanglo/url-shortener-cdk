# 🏗️ URL Shortener Service - Architecture Diagram

> **🤖 Built with Amazon Q Developer**  
> Complete serverless architecture generated by AI

## 📊 System Architecture Overview

```mermaid
graph TB
    %% External Users
    User[👤 User/Client]
    Browser[🌐 Web Browser]
    
    %% DNS & Domain
    Route53[🌍 Route53<br/>DNS Management]
    ACM[🔒 ACM Certificate<br/>SSL/TLS]
    
    %% API Gateway
    CustomDomain[🔗 Custom Domain<br/>url.loweitang.com]
    APIGW[🚪 API Gateway<br/>HTTP API]
    
    %% Authentication
    Cognito[🔐 Amazon Cognito<br/>User Pool]
    JWT[🎫 JWT Authorizer]
    
    %% Lambda Functions
    subgraph "Lambda Functions"
        CreateURL[📝 Create URL<br/>Lambda]
        GetURLs[📋 Get URLs<br/>Lambda]
        DeleteURL[🗑️ Delete URL<br/>Lambda]
        Redirect[↩️ Redirect<br/>Lambda]
        Signup[👥 Signup<br/>Lambda]
        Login[🔑 Login<br/>Lambda]
    end
    
    %% Shared Layer
    Layer[📦 Lambda Layer<br/>Shared Dependencies]
    
    %% Database
    DynamoDB1[🗄️ DynamoDB<br/>URL Table]
    DynamoDB2[🗄️ DynamoDB<br/>User Table]
    
    %% IAM
    IAM[🛡️ IAM Roles<br/>& Policies]
    
    %% Monitoring
    CloudWatch[📊 CloudWatch<br/>Logs & Metrics]
    XRay[🔍 X-Ray<br/>Tracing]
    
    %% User Flow
    User --> Browser
    Browser --> Route53
    Route53 --> CustomDomain
    CustomDomain --> APIGW
    
    %% Authentication Flow
    APIGW --> JWT
    JWT --> Cognito
    
    %% API Routes
    APIGW --> CreateURL
    APIGW --> GetURLs
    APIGW --> DeleteURL
    APIGW --> Redirect
    APIGW --> Signup
    APIGW --> Login
    
    %% Lambda Dependencies
    CreateURL --> Layer
    GetURLs --> Layer
    DeleteURL --> Layer
    Redirect --> Layer
    Signup --> Layer
    Login --> Layer
    
    %% Database Access
    CreateURL --> DynamoDB1
    GetURLs --> DynamoDB1
    DeleteURL --> DynamoDB1
    Redirect --> DynamoDB1
    Signup --> DynamoDB2
    Login --> DynamoDB2
    
    %% Authentication Integration
    Signup --> Cognito
    Login --> Cognito
    
    %% Security
    CreateURL --> IAM
    GetURLs --> IAM
    DeleteURL --> IAM
    Redirect --> IAM
    Signup --> IAM
    Login --> IAM
    
    %% Monitoring
    CreateURL --> CloudWatch
    GetURLs --> CloudWatch
    DeleteURL --> CloudWatch
    Redirect --> CloudWatch
    Signup --> CloudWatch
    Login --> CloudWatch
    
    CreateURL --> XRay
    GetURLs --> XRay
    DeleteURL --> XRay
    Redirect --> XRay
    Signup --> XRay
    Login --> XRay
    
    %% SSL
    CustomDomain --> ACM
    
    %% Styling
    classDef userClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef awsService fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef lambda fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef database fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef security fill:#ffebee,stroke:#b71c1c,stroke-width:2px
    
    class User,Browser userClass
    class Route53,CustomDomain,APIGW,ACM,CloudWatch,XRay awsService
    class CreateURL,GetURLs,DeleteURL,Redirect,Signup,Login,Layer lambda
    class DynamoDB1,DynamoDB2 database
    class Cognito,JWT,IAM security
```

## 🔄 Data Flow Diagrams

### 1. URL Creation Flow
```mermaid
sequenceDiagram
    participant U as User
    participant A as API Gateway
    participant J as JWT Authorizer
    participant C as Cognito
    participant L as Create URL Lambda
    participant D as DynamoDB
    
    U->>A: POST /createurl
    A->>J: Validate JWT Token
    J->>C: Verify Token
    C-->>J: Token Valid
    J-->>A: Authorized
    A->>L: Invoke Lambda
    L->>D: Store URL Data
    D-->>L: Success
    L-->>A: Short URL Created
    A-->>U: Return Short URL
```

### 2. URL Redirect Flow
```mermaid
sequenceDiagram
    participant U as User
    participant A as API Gateway
    participant L as Redirect Lambda
    participant D as DynamoDB
    
    U->>A: GET /{shortCode}
    A->>L: Invoke Lambda (No Auth)
    L->>D: Query by Short Code
    D-->>L: Return Original URL
    L-->>A: HTTP 302 Redirect
    A-->>U: Redirect to Original URL
```

### 3. User Authentication Flow
```mermaid
sequenceDiagram
    participant U as User
    participant A as API Gateway
    participant L as Login Lambda
    participant C as Cognito
    
    U->>A: POST /login
    A->>L: Invoke Lambda (No Auth)
    L->>C: Authenticate User
    C-->>L: JWT Token
    L-->>A: Return Token
    A-->>U: JWT Token for API Access
```

## 🏗️ CDK Stack Architecture

```mermaid
graph LR
    subgraph "CDK Stacks"
        DB[📊 Database Stack<br/>DynamoDB Tables]
        SEC[🔐 Security Stack<br/>Cognito + IAM]
        API[🚪 API Stack<br/>Gateway + Lambda]
    end
    
    subgraph "Dependencies"
        DB --> SEC
        SEC --> API
    end
    
    subgraph "Resources"
        DB --> DDB1[URL Table]
        DB --> DDB2[User Table]
        
        SEC --> COG[Cognito User Pool]
        SEC --> ROLE[IAM Roles]
        
        API --> GW[API Gateway]
        API --> LAM[6x Lambda Functions]
        API --> DOM[Custom Domain]
        API --> CERT[SSL Certificate]
    end
```

## 🌍 Multi-Environment Architecture

```mermaid
graph TB
    subgraph "Development Environment"
        DEV_DOMAIN[url-dev.loweitang.com]
        DEV_STACK[UrlShortener-*-dev]
    end
    
    subgraph "Staging Environment"
        STAGE_DOMAIN[url-staging.loweitang.com]
        STAGE_STACK[UrlShortener-*-staging]
    end
    
    subgraph "Production Environment"
        PROD_DOMAIN[url.loweitang.com]
        PROD_STACK[UrlShortener-*-prod]
    end
    
    subgraph "Shared Resources"
        ROUTE53[Route53 Hosted Zone<br/>loweitang.com]
        SES[SES Email Service]
    end
    
    DEV_DOMAIN --> ROUTE53
    STAGE_DOMAIN --> ROUTE53
    PROD_DOMAIN --> ROUTE53
    
    DEV_STACK --> SES
    STAGE_STACK --> SES
    PROD_STACK --> SES
```

## 📋 API Endpoints Overview

| Method | Endpoint | Auth Required | Lambda Function | Description |
|--------|----------|---------------|-----------------|-------------|
| POST | `/signup` | ❌ No | Signup Lambda | User registration |
| POST | `/login` | ❌ No | Login Lambda | User authentication |
| POST | `/createurl` | ✅ Yes | Create URL Lambda | Create short URL |
| GET | `/geturls` | ✅ Yes | Get URLs Lambda | List user URLs |
| DELETE | `/deleteurl/{id}` | ✅ Yes | Delete URL Lambda | Delete URL |
| GET | `/{shortCode}` | ❌ No | Redirect Lambda | Redirect to original |

## 🔒 Security Architecture

```mermaid
graph TB
    subgraph "Authentication Layer"
        COGNITO[Amazon Cognito<br/>User Pool]
        JWT_AUTH[JWT Authorizer]
    end
    
    subgraph "Authorization Layer"
        IAM_ROLES[IAM Roles]
        POLICIES[IAM Policies]
    end
    
    subgraph "Network Security"
        HTTPS[HTTPS Only<br/>ACM Certificate]
        CORS[CORS Configuration]
    end
    
    subgraph "Data Security"
        ENCRYPTION[DynamoDB Encryption]
        SECRETS[Secrets Manager]
    end
    
    COGNITO --> JWT_AUTH
    JWT_AUTH --> IAM_ROLES
    IAM_ROLES --> POLICIES
    
    HTTPS --> CORS
    ENCRYPTION --> SECRETS
```

## 📊 Monitoring & Observability

```mermaid
graph LR
    subgraph "Application Metrics"
        LAMBDA[Lambda Functions]
        API_GW[API Gateway]
        DYNAMO[DynamoDB]
    end
    
    subgraph "Monitoring Services"
        CW_LOGS[CloudWatch Logs]
        CW_METRICS[CloudWatch Metrics]
        XRAY[X-Ray Tracing]
    end
    
    subgraph "Alerting"
        ALARMS[CloudWatch Alarms]
        SNS[SNS Notifications]
    end
    
    LAMBDA --> CW_LOGS
    LAMBDA --> CW_METRICS
    LAMBDA --> XRAY
    
    API_GW --> CW_LOGS
    API_GW --> CW_METRICS
    
    DYNAMO --> CW_METRICS
    
    CW_METRICS --> ALARMS
    ALARMS --> SNS
```

---

## 🤖 Architecture Generated by Amazon Q Developer

This complete serverless architecture was designed and generated entirely by **Amazon Q Developer AI Assistant**, demonstrating:

- ✅ **Scalable Design**: Auto-scaling serverless components
- ✅ **Security Best Practices**: Multi-layer security implementation
- ✅ **High Availability**: Multi-AZ deployment ready
- ✅ **Cost Optimization**: Pay-per-use serverless model
- ✅ **Monitoring Ready**: Complete observability stack
- ✅ **Multi-Environment**: Dev/Staging/Production separation

**🎯 Total Components**: 20+ AWS Services integrated seamlessly
